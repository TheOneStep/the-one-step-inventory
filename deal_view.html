<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ê±°ë˜ ìƒì„¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f6f7f9;margin:0;padding:20px}
.box{max-width:420px;margin:0 auto;background:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 10px rgba(0,0,0,.06)}
h3{text-align:center;margin-bottom:12px}
.row{margin-bottom:8px;font-size:14px}
.label{color:#777;font-size:12px}
.value{font-weight:600}
.btn{width:100%;padding:12px;border-radius:999px;border:none;font-size:15px;margin-top:12px}
.btn-edit{background:#007aff;color:#fff}
/* âœ… ê±°ë˜ íƒ€ì…ë³„ ë°°ê²½ (ë¦¬ìŠ¤íŠ¸ì™€ ë™ì¼) */
.box.purchase {
  background: #eef4ff;
}

.box.sale {
  background: #fff0f0;
}

/* âœ… ìƒì„¸ í˜ì´ì§€ ë©”ì¸ ì´ë¯¸ì§€ */
.img-card{
  margin: 12px 0 14px;
  background:#fff;
  border-radius:16px;
  overflow:hidden;                 /* ì´ë¯¸ì§€ ê½‰ ì±„ìš°ê¸° */
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

/* âœ… ì´ë¯¸ì§€ í¬ê²Œ */
.img-card img{
  width:100%;
  height:280px;                    /* ğŸ”¥ í•µì‹¬ */
  max-height:320px;
  object-fit:cover;
  display:block;
}

.bc-chip{
  margin: 2px 0 12px;
}

.bc-chip{
  display:inline-block;
  margin: -6px 0 12px;   /* ì´ë¯¸ì§€ë‘ ë¶™ì„ */
  padding: 6px 12px;
  font-size:12px;
  border-radius:999px;
  background:#fff;
  border:1px solid #ddd;
}
</style>
</head>
<body>
<div class="box" id="box"></div>

<script>
// âœ… ìˆ«ì ì½¤ë§ˆ í‘œì‹œìš© (í™”ë©´ ì¶œë ¥ ì „ìš©)
function fmt(v) {
  return (Number(v) || 0).toLocaleString("ko-KR");
}  
const params = new URLSearchParams(location.search);
const key = params.get("key");
const id = params.get("id");
const box = document.getElementById("box");

if (!key || !id) {
  box.innerHTML = "<p>ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.</p>";
} else {

  const list = JSON.parse(localStorage.getItem(key) || "[]");
  const item = list.find(i => i.id === id);
  
  // âœ… ìƒí’ˆ ëŒ€í‘œ ì´ë¯¸ì§€ ë§µ
  const productImageMap = JSON.parse(
    localStorage.getItem("product_image_map") || "{}"
  );

  // âœ… ë°”ì½”ë“œ & ì´ë¯¸ì§€ ì†ŒìŠ¤ ê²°ì •
  const barcode = item?.barcode || "";
  const imageSrc = (barcode && productImageMap[barcode]) || item?.image || "";

  // âœ… ê±°ë˜ íƒ€ì…ì— ë”°ë¼ ë°°ê²½ìƒ‰ ì ìš© (ë¦¬ìŠ¤íŠ¸ì™€ ë™ì¼)
  if (key === "purchase_list") {
    box.classList.add("purchase");
  } else if (key === "sales_list") {
    box.classList.add("sale");
  }

  if (!item) {
    box.innerHTML = "<p>ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
  } else {

    /* ======================
       ğŸŸ¦ ë§¤ì… ìƒì„¸
    ====================== */
    if (key === "purchase_list") {
      box.innerHTML = `
        <h3>ë§¤ì… ìƒì„¸</h3>

        ${imageSrc ? `
          <div class="img-card">
            <img src="${imageSrc}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
          </div>
        ` : ""}

        <div class="row"><div class="label">ìƒí’ˆëª…</div><div class="value">${item.name || ""}</div></div>
        <div class="row"><div class="label">ë°”ì½”ë“œ</div><div class="value">${item.barcode || ""}</div></div>
        <div class="row"><div class="label">ë§¤ì…ì¼ì</div><div class="value">${item.purchaseDate || ""}</div></div>
        <div class="row"><div class="label">ê°€ê²©</div><div class="value">${fmt(item.price)}</div></div>
        <div class="row"><div class="label">ìˆ˜ëŸ‰</div><div class="value">${fmt(item.qty)}</div></div>
        <div class="row"><div class="label">ë§¤ì… ì´ì•¡</div><div class="value">${fmt(item.price * item.qty)}</div></div>

        ${item.memo ? `
          <div class="row">
            <div class="label">ë©”ëª¨</div>
            <div class="value">${item.memo}</div>
          </div>` : ""
        }

        <button class="btn btn-edit" onclick="goEdit()">ìˆ˜ì •</button>
      `;
    }

    /* ======================
       ğŸŸ¥ ë‚©í’ˆ ìƒì„¸
    ====================== */
    else if (key === "sales_list") {
      box.innerHTML = `
        <h3>ë‚©í’ˆ ìƒì„¸</h3>

        ${imageSrc ? `
          <div class="img-card">
            <img src="${imageSrc}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
          </div>
        ` : ""}

        <div class="row"><div class="label">ê±°ë˜ì²˜</div><div class="value">${item.partner || ""}</div></div>
        <div class="row"><div class="label">ìƒí’ˆëª…</div><div class="value">${item.productName || item.name || ""}</div></div>
        <div class="row"><div class="label">ë°”ì½”ë“œ</div><div class="value">${item.barcode || ""}</div></div>
        <div class="row"><div class="label">ë‚©í’ˆì¼ì</div><div class="value">${item.saleDate || ""}</div></div>
        <div class="row"><div class="label">ê°€ê²©</div><div class="value">${fmt(item.price)}</div></div>
        <div class="row"><div class="label">ìˆ˜ëŸ‰</div><div class="value">${fmt(item.qty)}</div></div>
        <div class="row"><div class="label">ë‚©í’ˆ ì´ì•¡</div><div class="value">${fmt(item.price * item.qty)}</div></div>

        ${item.memo ? `
          <div class="row">
            <div class="label">ë©”ëª¨</div>
            <div class="value">${item.memo}</div>
          </div>` : ""
        }

        <button class="btn btn-edit" onclick="goEdit()">ìˆ˜ì •</button>
      `;
    }

  } // â† item else ë‹«í˜
}   // â† key/id else ë‹«í˜

function goEdit() {
  // ğŸŸ¦ ë§¤ì…
  if (key === "purchase_list") {
    location.href =
      "purchase_barcode_edit.html?mode=edit&id=" + id;
  }

  // ğŸŸ¥ ë‚©í’ˆ(ë§¤ì¶œ)
  else if (key === "sales_list") {
    location.href =
      "sales_barcode_edit.html?mode=edit&id=" + id;
  }
}
</script>

</body>
</html>
